"use strict";(self.webpackChunktetanes_www=self.webpackChunktetanes_www||[]).push([[607],{678:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{AF:()=>i.AF,RV:()=>i.RV});var i=n(598),a=e([i]);i=(a.then?(await a)():a)[0],r()}catch(e){r(e)}}))},598:(e,t,n)=>{n.a(e,(async(r,i)=>{try{n.d(t,{$L:()=>z,AF:()=>E,DI:()=>L,Ni:()=>O,Nk:()=>F,Or:()=>ne,QT:()=>U,RV:()=>R,Sn:()=>q,VD:()=>X,Wl:()=>k,XP:()=>J,bj:()=>Z,cr:()=>W,e:()=>B,eY:()=>I,ex:()=>S,f5:()=>N,fP:()=>K,gW:()=>M,go:()=>P,h4:()=>V,ib:()=>ee,jp:()=>Y,kH:()=>te,lB:()=>Q,m_:()=>j,o$:()=>G,oH:()=>re,ug:()=>D,wJ:()=>$,yB:()=>H});var a=n(545);e=n.hmd(e);var o=r([a]);a=(o.then?(await o)():o)[0];const s=new Array(32).fill(void 0);function u(e){return s[e]}s.push(void 0,null,!0,!1);let c=s.length;function l(e){e<36||(s[e]=c,c=e)}function f(e){const t=u(e);return l(e),t}let d=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});d.decode();let h=new Uint8Array;function _(){return 0===h.byteLength&&(h=new Uint8Array(a.memory.buffer)),h}function b(e,t){return d.decode(_().subarray(e,e+t))}function g(e){c===s.length&&s.push(s.length+1);const t=c;return c=s[t],s[t]=e,t}let m=new Float32Array;function p(){return 0===m.byteLength&&(m=new Float32Array(a.memory.buffer)),m}let w=0;function v(e,t){const n=t(4*e.length);return p().set(e,n/4),w=e.length,n}function y(e,t){const n=t(1*e.length);return _().set(e,n/1),w=e.length,n}let x=new("undefined"==typeof TextEncoder?(0,e.require)("util").TextEncoder:TextEncoder)("utf-8");const A="function"==typeof x.encodeInto?function(e,t){return x.encodeInto(e,t)}:function(e,t){const n=x.encode(e);return t.set(n),{read:e.length,written:n.length}};function T(e,t,n){if(void 0===n){const n=x.encode(e),r=t(n.length);return _().subarray(r,r+n.length).set(n),w=n.length,r}let r=e.length,i=t(r);const a=_();let o=0;for(;o<r;o++){const t=e.charCodeAt(o);if(t>127)break;a[i+o]=t}if(o!==r){0!==o&&(e=e.slice(o)),i=n(i,r,r=o+3*e.length);const t=_().subarray(i+o,i+r);o+=A(e,t).written}return w=o,i}function E(){return f(a.wasm_memory())}function C(e,t){try{return e.apply(this,t)}catch(e){a.__wbindgen_exn_store(g(e))}}class R{static __wrap(e){const t=Object.create(R.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();a.__wbg_nes_free(e)}static init(){a.nes_init()}static new(e,t){const n=a.nes_new(e,t);return R.__wrap(n)}pause(e){a.nes_pause(this.ptr,e)}set_sound(e){a.nes_set_sound(this.ptr,e)}frame(){return a.nes_frame(this.ptr)}audio_callback(e){try{var t=v(e,a.__wbindgen_malloc),n=w;a.nes_audio_callback(this.ptr,t,n)}finally{e.set(p().subarray(t/4,t/4+n)),a.__wbindgen_free(t,4*n)}}width(){return a.nes_width(this.ptr)>>>0}height(){return a.nes_height(this.ptr)>>>0}sample_rate(){return a.nes_sample_rate(this.ptr)}clock_frame(){a.nes_clock_frame(this.ptr)}load_rom(e){const t=y(e,a.__wbindgen_malloc),n=w;a.nes_load_rom(this.ptr,t,n)}handle_event(e,t,n){const r=T(e,a.__wbindgen_malloc,a.__wbindgen_realloc),i=w;return 0!==a.nes_handle_event(this.ptr,r,i,t,n)}}function S(){return C((function(e,t,n){var r,i;u(e).randomFillSync((r=t,i=n,_().subarray(r/1,r/1+i)))}),arguments)}function D(e){f(e)}function B(){return C((function(e,t){u(e).getRandomValues(u(t))}),arguments)}function F(e){return g(u(e).crypto)}function k(e){const t=u(e);return"object"==typeof t&&null!==t}function L(e){return g(u(e).process)}function U(e){return g(u(e).versions)}function N(e){return g(u(e).node)}function I(e){return"string"==typeof u(e)}function W(e){return g(u(e).msCrypto)}function P(){return C((function(){return g(e.require)}),arguments)}function G(e){return"function"==typeof u(e)}function V(e,t){return g(b(e,t))}function M(e,t){return g(new Function(b(e,t)))}function O(){return C((function(e,t){return g(u(e).call(u(t)))}),arguments)}function j(e){return g(u(e))}function X(){return C((function(e,t,n){return g(u(e).call(u(t),u(n)))}),arguments)}function Y(e){return g(u(e).buffer)}function H(){return C((function(){return g(self.self)}),arguments)}function q(){return C((function(){return g(window.window)}),arguments)}function z(){return C((function(){return g(globalThis.globalThis)}),arguments)}function $(){return C((function(){return g(n.g.global)}),arguments)}function J(e){return void 0===u(e)}function Q(e){return g(new Uint8Array(u(e)))}function K(e,t,n){u(e).set(u(t),n>>>0)}function Z(e){return u(e).length}function ee(e){return g(new Uint8Array(e>>>0))}function te(e,t,n){return g(u(e).subarray(t>>>0,n>>>0))}function ne(e,t){throw new Error(b(e,t))}function re(){return g(a.memory)}i()}catch(ie){i(ie)}}))},607:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.r(t);var i=n(678),a=e([i]);i=(a.then?(await a)():a)[0];var o=256,s=240,u="view",c=1e3/60,l=[{name:"Alter Ego",filename:"alter_ego.nes"},{name:"AO",filename:"ao_demo.nes"},{name:"Assimilate",filename:"assimilate.nes"},{name:"Blade Buster",filename:"blade_buster.nes"},{name:"From Below",filename:"from_below.nes"},{name:"Lan Master",filename:"lan_master.nes"},{name:"Streemerz",filename:"streemerz.nes"}],f=function(e){var t=document.getElementById(e);return t||console.error("".concat(e," not found")),t},d=f(u),h=f("backView"),_=function(e,t,n){var r,i=document.createElement("canvas");i.id=u,null===(r=d.parentNode)||void 0===r||r.replaceChild(i,d),(d=i).width=n*e,d.height=n*t;var a=d.getContext("webgl");if(!a)return console.error("WebGL rendering context not found."),null;var o=a.createShader(a.VERTEX_SHADER),s=a.createShader(a.FRAGMENT_SHADER);if(!o||!s)return console.error("WebGL shader creation failed."),null;if(a.shaderSource(o,"\n    attribute vec2 a_position;\n    attribute vec2 a_texcoord;\n    uniform mat4 u_matrix;\n    varying vec2 v_texcoord;\n    void main() {\n        gl_Position = u_matrix * vec4( a_position, 0.0, 1.0 );\n        v_texcoord = a_texcoord;\n    }\n  "),a.shaderSource(s,"\n    precision mediump float;\n    varying vec2 v_texcoord;\n    uniform sampler2D u_sampler;\n    void main() {\n        gl_FragColor = vec4( texture2D( u_sampler, vec2( v_texcoord.s, v_texcoord.t ) ).rgb, 1.0 );\n    }\n  "),a.compileShader(o),a.compileShader(s),!a.getShaderParameter(o,a.COMPILE_STATUS))return console.error("WebGL vertex shader compilation failed:",a.getShaderInfoLog(o)),null;if(!a.getShaderParameter(s,a.COMPILE_STATUS))return console.error("WebGL fragment shader compilation failed:",a.getShaderInfoLog(s)),null;var c=a.createProgram();if(!c)return console.error("WebGL program creation failed."),null;if(a.attachShader(c,o),a.attachShader(c,s),a.linkProgram(c),!a.getProgramParameter(c,a.LINK_STATUS))return console.error("WebGL program linking failed!"),null;a.useProgram(c);var l=a.getAttribLocation(c,"a_position"),f=a.getAttribLocation(c,"a_texcoord");a.enableVertexAttribArray(l),a.enableVertexAttribArray(f);var h=a.getUniformLocation(c,"u_sampler");a.uniform1i(h,0);var _,b,g,m=(b=t,0,(g=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])[0]=2/((_=e)-0),g[5]=2/(0-b),g[12]=(_+0)/(_-0)*-1,g[13]=(0+b)/(0-b)*-1,g),p=a.getUniformLocation(c,"u_matrix");a.uniformMatrix4fv(p,!1,m);var w=a.createTexture();a.bindTexture(a.TEXTURE_2D,w),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,e,e,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array(e*e*4)),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);var v=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,v);var y=[0,0,0,t,e,0,e,t];a.bufferData(a.ARRAY_BUFFER,new Float32Array(y),a.STATIC_DRAW),a.vertexAttribPointer(l,2,a.FLOAT,!1,0,0);var x=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,x);var A=[0,0,0,t/e,1,0,1,t/e];a.bufferData(a.ARRAY_BUFFER,new Float32Array(A),a.STATIC_DRAW),a.vertexAttribPointer(f,2,a.FLOAT,!1,0,0);var T=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,T),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,2,3,1]),a.STATIC_DRAW),a.clear(a.COLOR_BUFFER_BIT),a.enable(a.DEPTH_TEST);var E=[0,0,d.width,d.height];return a.viewport.apply(a,E),a},b=function(e,t,n){var r,i=document.createElement("canvas");i.id=u,null===(r=d.parentNode)||void 0===r||r.replaceChild(i,d),(d=i).width=n*e,d.height=n*t,h.width=e,h.height=t;var a=d.getContext("2d"),o=h.getContext("2d");if(!a||!o)return console.error("Web2d rendering context not found."),null;var s=new Path2D,c=[0,8,e,t-16];s.rect.apply(s,c),a.scale(n,n),a.clip(s);var l=o.createImageData(e,t);return l?{canvasCtx:a,backCanvasCtx:o,imageData:l,imageBuffer:new Uint8Array(l.data.buffer)}:(console.error("imageData creation failed."),null)},g=function(){function e(){if(this.webgl=null,this.canvasCtx=null,this.backCanvasCtx=null,this.loaded=!1,this.paused=!0,this.scale=2,this.width=this.scale*o,this.height=this.scale*s,this.imageData=null,this.imageBuffer=new Uint8Array(245760),this.sampleRate=44100,this.bufferSize=735,this.maxDelta=.02,this.audioCtx=null,this.gainNode=null,this.emptyBuffers=[],this.nextStartTime=0,this.lastFrameTime=0,this.animationId=0,this.nes=i.RV.new(this.sampleRate,this.maxDelta),this.fps=new m,this.audioEnabled=!1,this.keybinds=["Escape","Enter","Shift","a","s","z","x","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],this.webgl=_(o,s,this.scale),!this.webgl){console.log("No WebGL. Falling back to Web2D");var e=b(o,s,this.scale);if(!e)return console.error("Web2d creation failed"),void w("Rendering not supported in this browser");this.canvasCtx=e.canvasCtx,this.backCanvasCtx=e.backCanvasCtx,this.imageData=e.imageData,this.imageBuffer=e.imageBuffer}}return e.prototype.run=function(){var e=this;if(!this.paused){this.animationId=requestAnimationFrame((function(){e.run()}));var t=performance.now(),n=t-this.lastFrameTime;n>=c&&(this.lastFrameTime=t-n%c,this.fps.tick(),this.nes.clock_frame(),this.queueAudio(),this.render())}},e.prototype.loadRom=function(e){this.nes.load_rom(e),this.fps=new m,this.loaded||this.setupAudio(),this.loaded=!0,this.pause(!1);var t=f("load-rom-label");t&&(t.textContent="Change ROM"),p(),this.run()},e.prototype.setupAudio=function(){var e=window.AudioContext||window.webkitAudioContext;if(e)this.audioCtx=new e,this.gainNode=this.audioCtx.createGain(),this.gainNode.gain.setValueAtTime(1,0);else{console.error("Browser does not support audio");var t=f("toggle-audio");t&&(t.textContent="Sound Not Supported",t.disabled=!0)}},e.prototype.setSound=function(e){this.audioEnabled=e,this.nes.set_sound(e),this.silenceSound(!e);var t=f("toggle-audio");t&&(this.audioEnabled?t.textContent="Mute":t.textContent="Unmute")},e.prototype.handleEvent=function(e,t,n){return!(!this.loaded||!this.keybinds.includes(e)||("Escape"===e&&t?this.pause(!this.paused):this.nes.handle_event(e,t,n),0))},e.prototype.setScale=function(e){if(this.scale=e,this.width=this.scale*o,this.height=this.scale*s,this.webgl){if(this.webgl=_(o,s,this.scale),!this.webgl)return void console.error("WebGL creation failed")}else if(this.canvasCtx){var t=b(o,s,this.scale);if(!t)return void console.error("Web2d creation failed");this.canvasCtx=t.canvasCtx,this.imageData=t.imageData,this.imageBuffer=t.imageBuffer}},e.prototype.pause=function(e){if(this.loaded){this.paused=e,this.nes.pause(e),this.loaded&&(e?(cancelAnimationFrame(this.animationId),this.silenceSound(!0)):(this.silenceSound(!1),this.run()));var t=f("toggle-pause");t&&(this.paused?t.textContent="Unpause":t.textContent="Pause")}},e.prototype.silenceSound=function(e){this.audioCtx&&this.gainNode&&(e?this.gainNode.gain.exponentialRampToValueAtTime(.001,this.audioCtx.currentTime+.3):this.gainNode.gain.exponentialRampToValueAtTime(1,this.audioCtx.currentTime+.3))},e.prototype.getAudioBuffer=function(){if(!this.audioCtx)throw new Error("AudioContext not created");return this.emptyBuffers.length?this.emptyBuffers.pop():this.audioCtx.createBuffer(1,this.bufferSize,this.sampleRate)},e.prototype.queueAudio=function(){var e=this;if(this.audioEnabled){if(!this.audioCtx||!this.gainNode)throw new Error("Audio not set up correctly");this.gainNode.gain.setValueAtTime(1,this.audioCtx.currentTime);var t=this.getAudioBuffer();this.nes.audio_callback(t.getChannelData(0));var n=this.audioCtx.createBufferSource();n.buffer=t,n.connect(this.gainNode).connect(this.audioCtx.destination),n.onended=function(){e.emptyBuffers.push(t)};var r=this.audioCtx.currentTime+.032,i=Math.max(this.nextStartTime,r);n.start(i),this.nextStartTime=i+this.bufferSize/this.sampleRate}},e.prototype.render=function(){this.imageBuffer=new Uint8Array((0,i.AF)().buffer,this.nes.frame(),245760),this.webgl?(this.webgl.texSubImage2D(this.webgl.TEXTURE_2D,0,0,0,o,s,this.webgl.RGBA,this.webgl.UNSIGNED_BYTE,this.imageBuffer),this.webgl.drawElements(this.webgl.TRIANGLES,6,this.webgl.UNSIGNED_SHORT,0)):this.canvasCtx&&this.imageData?(this.backCanvasCtx.putImageData(this.imageData,0,0),this.canvasCtx.drawImage(h,0,0)):console.error("WebGL and Web2D failed to render")},e}(),m=function(){function e(){this.frameCount=0,this.elapsed=0,this.lastFrameTime=0,this.history=Array.from({length:30},(function(){return 60})),this.historyWrite=0,this.fpsCounter=f("fps")}return e.prototype.tick=function(){this.frameCount+=1;var e=performance.now(),t=e-this.lastFrameTime;if(this.elapsed+=t,this.lastFrameTime=e,this.frameCount%60==0){var n=1e3/(this.elapsed/60);this.fpsCounter.textContent="FPS: ".concat(n.toFixed(2)),this.elapsed=0,this.history[this.historyWrite]=n,this.historyWrite=(this.historyWrite+1)%this.history.length}},e}(),p=function(){return w("")},w=function(e){var t=f("error");t&&(t.textContent=e)};!function(){i.RV.init();var e=new g;!function(e){var t=f("load-rom");t&&(t.addEventListener("click",(function(t){e.pause(!0),t.currentTarget.blur()})),t.addEventListener("change",(function(t){var n=new FileReader,r=t.currentTarget.files;n&&(null==r?void 0:r.length)&&r[0]?(n.readAsArrayBuffer(r[0]),n.onload=function(){var t=new Uint8Array(n.result);e.loadRom(t)}):(console.error("failed to load rom"),e.loaded&&e.pause(!1))}),!1))}(e),function(e){for(var t=function(t){var n=f("scale".concat(t));n&&n.addEventListener("click",(function(n){e.setScale(t),n.currentTarget.blur()}),!1)},n=1;n<=3;++n)t(n);var r=f("toggle-audio");r&&r.addEventListener("click",(function(t){e.setSound(!e.audioEnabled),t.currentTarget.blur()}),!1);var i=f("toggle-pause");i&&i.addEventListener("click",(function(t){e.pause(!e.paused),t.currentTarget.blur()}),!1),window.addEventListener("keydown",(function(t){e.handleEvent(t.key,!0,t.repeat)&&t.preventDefault()})),window.addEventListener("keyup",(function(t){e.handleEvent(t.key,!1,t.repeat)&&t.preventDefault()}))}(e),function(e){var t=f("homebrew-menu"),n=f("homebrew-list"),r=f("load-homebrew"),i=f("homebrew-close");if(t&&n&&r&&i){var a=function(n){e.pause(!1),t.classList.add("hidden"),n.currentTarget.blur()};r.addEventListener("click",(function(n){e.pause(!0),t.classList.remove("hidden"),n.currentTarget.blur()}),!1),i.addEventListener("click",a,!1);for(var o=function(t){var r=document.createElement("button");r.textContent=t.name,r.addEventListener("click",(function(n){return r=void 0,i=void 0,s=function(){var r,i,o,s;return function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}(this,(function(u){switch(u.label){case 0:a(n),u.label=1;case 1:return u.trys.push([1,4,,5]),[4,fetch("roms/".concat(t.filename))];case 2:return r=u.sent(),o=Uint8Array.bind,[4,r.arrayBuffer()];case 3:return i=new(o.apply(Uint8Array,[void 0,u.sent()])),e.loadRom(i),[3,5];case 4:return(s=u.sent())instanceof Error&&(console.error(s.message),w("Failed to load ROM.")),[3,5];case 5:return[2]}}))},new((o=void 0)||(o=Promise))((function(e,t){function n(e){try{u(s.next(e))}catch(e){t(e)}}function a(e){try{u(s.throw(e))}catch(e){t(e)}}function u(t){var r;t.done?e(t.value):(r=t.value,r instanceof o?r:new o((function(e){e(r)}))).then(n,a)}u((s=s.apply(r,i||[])).next())}));var r,i,o,s})),n.appendChild(r)},s=0,u=l;s<u.length;s++)o(u[s])}}(e)}(),r()}catch(e){r(e)}}))},545:(e,t,n)=>{n.a(e,(async(r,i)=>{try{var a,o=r([a=n(598)]),[a]=o.then?(await o)():o;await n.v(t,e.id,"9e606a6b2ba8b7aaa7e1",{"./tetanes_web_bg.js":{__wbg_randomFillSync_6894564c2c334c42:a.ex,__wbindgen_object_drop_ref:a.ug,__wbg_getRandomValues_805f1c3d65988a5a:a.e,__wbg_crypto_e1d53a1d73fb10b8:a.Nk,__wbindgen_is_object:a.Wl,__wbg_process_038c26bf42b093f8:a.DI,__wbg_versions_ab37218d2f0b24a8:a.QT,__wbg_node_080f4b19d15bc1fe:a.f5,__wbindgen_is_string:a.eY,__wbg_msCrypto_6e7d3e1f92610cbb:a.cr,__wbg_require_78a3dcfbdba9cbce:a.go,__wbindgen_is_function:a.o$,__wbindgen_string_new:a.h4,__wbg_newnoargs_b5b063fc6c2f0376:a.gW,__wbg_call_97ae9d8645dc388b:a.Ni,__wbindgen_object_clone_ref:a.m_,__wbg_call_168da88779e35f61:a.VD,__wbg_buffer_3f3d764d4747d564:a.jp,__wbg_self_6d479506f72c6a71:a.yB,__wbg_window_f2557cc78490aceb:a.Sn,__wbg_globalThis_7f206bda628d5286:a.$L,__wbg_global_ba75c50d1cf384f4:a.wJ,__wbindgen_is_undefined:a.XP,__wbg_new_8c3f0052272a457a:a.lB,__wbg_set_83db9690f9353e79:a.fP,__wbg_length_9e1ae1900cb0fbd5:a.bj,__wbg_newwithlength_f5933855e4f48a19:a.ib,__wbg_subarray_58ad4efbb5bcb886:a.kH,__wbindgen_throw:a.Or,__wbindgen_memory:a.oH}}),i()}catch(e){i(e)}}),1)}}]);